from typing import List
from functools import cache
from math import inf
from heapq import heappop, heappush
from bisect import bisect_left, bisect_right

class Solution:
    def minCost(self, grid: List[List[int]], k: int) -> int:
        m = len(grid)
        n = len(grid[0])
        teleLookup = sorted([(x, ir - m, ix - n) for ir, row in enumerate(grid) for ix, x in enumerate(row)])
        print(f"teleLookup: {teleLookup}")
        teleLookupOpt = [[] for _ in range(k)]
        # for val, iTele, jTele in sorted([(x, ir - m, ix - n) for ir, row in enumerate(grid) for ix, x in enumerate(row)]):
        #     if not teleLookup or 

        best = [[[inf] * (k + 1) for _ in range(n)] for _ in range(m)] # best[i][j] = list, where index = number of teles used so far
        # @cache # would love to be able to "coerce" a cache entry hit based on arg logic
        # e.g. if remaining_teleports > q = max(remaining_teleports in cache), call minCostFromPosition(i, j, q)
        def minCostFromPosition(i: int, j: int, remaining_teleports: int) -> int:
            if not ~i and not ~j: return 0 # use negative indices for i and j, so (-1, -1) is bottom right cell 
            if grid[i][j] >= grid[-1][-1] and remaining_teleports: return 0
            # if remaining_teleports < 0: return inf
            # if remaining_teleports < len(best[i][j]): return best[i][j][remaining_teleports]
            if best[i][j][k - remaining_teleports] < inf: return best[i][j][k - remaining_teleports]
            bestHere = bestTele = inf
            if ~i: bestHere = min(bestHere, grid[i + 1][j] + minCostFromPosition(i + 1, j, remaining_teleports))
            if ~j: bestHere = min(bestHere, grid[i][j + 1] + minCostFromPosition(i, j + 1, remaining_teleports))
            if remaining_teleports > 0:
                # teleOptions = teleLookup[:bisect_right(teleLookup, (grid[i][j], inf, inf))]
                for val, iTele, jTele in teleLookupOpt[k - remaining_teleports]:
                    bestTele = min(bestTele, minCostFromPosition(iTele, jTele, remaining_teleports - 1))

                # if not teleLookupOpt: teleOptions = teleLookup[:bisect_right(teleLookup, (grid[i][j], inf, inf))]
                # elif teleLookupOpt[-1][0] < grid[i][j]: teleOptions = teleLookupOpt + teleLookup[bisect_right(teleLookup, teleLookupOpt[-1]):bisect_right(teleLookup, (grid[i][j], inf, inf))]
                # else: teleOptions = teleLookupOpt
                
                iTeleLookupLo = 0
                if teleLookupOpt[k - remaining_teleports]:
                    loMarker = (teleLookupOpt[k - remaining_teleports][-1][0], -inf, -inf)
                    iTeleLookupLo = bisect_left(teleLookup, loMarker)
                iTeleLookupHi = bisect_right(teleLookup, (grid[i][j], inf, inf))
                teleOptions = teleLookup[iTeleLookupLo:iTeleLookupHi]
                print(f"\tFor val {grid[i][j]}: teleOptions = {teleOptions}; teleLookupOpt[{k - remaining_teleports}]: {teleLookupOpt[k - remaining_teleports]}")
                for val, iTele, jTele in teleOptions:
                    # bestHere = min(bestHere, minCostFromPosition(iTele, jTele, remaining_teleports - 1))
                    # we can optimize this lookup
                    # when we find a great teleportation destination with a low value, any 
                    # destination with a value higher than that that is not as good cost-wise should be removed
                    # from future consideration immediately 
                    # the tricky part is, i guess, that means we may have to keep separate lists of tele_options
                    # based on the number of teleports we have remaining... OOF, is that necessary?? well, maybe not...
                    thisTele = minCostFromPosition(iTele, jTele, remaining_teleports - 1)
                    if thisTele < bestTele:
                        bestTele = thisTele
                        teleLookupOpt[k - remaining_teleports].append((val, iTele, jTele))

            best[i][j][k - remaining_teleports] = min(bestHere, bestTele)
            return bestHere

        print(f"\nGrid: {grid}\n")
        result = minCostFromPosition(-m, -n, k)
        print(f"Best: {best}")
        return result

        ###### BFS ######

        # m = len(grid)
        # n = len(grid[0])
        # teleLookup = sorted([(x, ir, ix) for ir, row in enumerate(grid) for ix, x in enumerate(row)])
        # # bestCost = [[(inf, 0) for _ in range(len(grid[0]))] for _ in range(len(grid))]
        # # bestCost[-1][-1] = (0, -k) # cost + remaining teles ... 
        # heap = [(0, m - 1, n - 1, -k)] # (cost, m, n, -k) ... -1, -1 ... 
        # while heap:
        #     cost, ir, ix, teles = heappop(heap)
        #     # ir = -ir
        #     # ix = -ix
        #     # if cost > bestCost[ir][ix][0]: continue
        #     # bestCost[ir][ix] = (cost, teles) # could it be we have to store a higher cost
        #     # if it has more available teleportations..? 
        #     if not ix and not ir: return cost
        #     if ix: heappush(heap, (cost + grid[ir][ix], ir, ix - 1, teles))
        #     if ir: heappush(heap, (cost + grid[ir][ix], ir - 1, ix, teles))
        #     if not teles: continue
        #     iTele = bisect_right(teleLookup, (grid[ir][ix], -1, -1)) # (grid[ir][ix], inf, inf)
        #     for val, iTeleR, iTeleX in teleLookup[iTele:]:
        #         if not iTeleR and not iTeleX: return cost
        #         if iTeleR == ir and iTeleX == ix: continue
        #         heappush(heap, (cost, iTeleR, iTeleX, teles + 1)) # MLE
        # # return -1

tests = [
    {
        "in": ([[1,3,3],[2,5,4],[4,3,5]], 2),
        "out": 7
    },
    {
        "in": ([[1,2],[2,3],[3,4]], 1),
        "out": 9
    },
    {
        "in": ([[5,9,8,0,5,9,10,10],
                [17,12,8,17,9,10,18,17],
                [7,16,16,11,16,11,13,20]], 9),
        "out": 37 # MLE on heap BFS approach 
        # after teleLookupOpt optimization, AssertionError: Expected 37, got 41
        # best path: (0,0) 5 [cost: 0] -> (1,0) 17 [cost: 17] -tele> (1,7) 17 [cost: 17] -> (2,8) 20 [cost: 37]
    },
    {
        "in": ([[675,861,452,877,889,134,492,280,820,257,510,345,620,16,669,921,459,741,510,496,574,229,643,587,625,485,639,652,323,23,214,227,838,756,429,719,679,229,854,599,398,486,138,211,107,850,754,728],[218,473,226,747,360,885,182,603,409,907,112,745,628,161,725,583,121,742,915,808,318,763,256,683,369,139,1016,833,827,154,217,288,909,293,897,601,391,486,691,1046,170,120,242,746,532,975,530,426],[666,613,1036,435,259,535,246,1079,398,530,351,985,1035,322,558,297,952,1067,398,966,973,880,877,984,596,829,309,1003,897,899,225,1060,577,842,543,557,986,193,855,1040,485,823,903,316,850,229,716,909],[334,889,601,1166,1025,920,1217,404,440,537,708,757,649,723,813,824,697,730,891,1020,1087,1122,626,714,420,940,815,380,675,594,797,1202,596,500,1110,1014,930,1217,595,1087,636,455,684,1077,1050,459,896,1091],[583,536,672,412,1041,786,1239,896,558,921,811,499,1007,623,1148,1097,921,1002,687,510,390,1240,423,1015,1290,722,1022,785,1094,999,1246,891,792,986,665,1234,576,1285,398,680,588,821,641,1332,735,894,574,739],[654,656,523,558,1172,1065,512,664,1239,1242,1182,597,637,1103,677,1113,1424,758,770,555,671,737,864,989,742,1418,1406,898,1191,739,825,1387,1361,640,742,833,1112,1181,523,604,1259,1075,1335,552,785,1242,779,1098],[1302,1155,778,1000,1412,1505,595,702,945,1099,1349,782,672,1149,1026,821,1035,763,1411,1515,1321,1506,1458,768,933,977,1464,1363,1242,947,1330,1377,1461,911,882,1304,1250,626,1460,730,842,1489,1206,1062,1256,726,839,1191],[1256,1590,1597,1533,1433,1049,1487,1118,915,979,1095,692,1007,1604,898,1478,1424,843,1551,1300,725,1283,890,1558,693,1162,781,1036,1185,784,1144,1596,1500,1039,1180,1367,774,998,834,1377,1362,1579,1016,1503,933,1007,1505,1526],[1425,1082,1045,1036,1676,1268,1509,1005,1061,1096,1322,1481,1215,1714,1251,1410,1030,1348,1376,1015,961,1117,1125,1095,1624,1704,1266,1406,1586,1466,1097,1027,1694,1647,1614,1013,1595,1329,1340,1073,1429,859,912,1661,893,988,1236,1510],[943,1793,1222,1635,1546,1537,1323,1016,948,1042,1018,1390,1172,1765,1123,1145,1480,1796,1344,900,984,1361,1341,905,1076,1434,1711,1505,1711,1453,1221,1730,1153,1670,1109,1709,949,870,1633,1698,1223,960,901,1648,1387,1813,1682,1304],[1376,1375,1288,1876,1063,1831,989,1219,1744,1710,1738,1443,1071,1409,1464,1497,1840,1279,1286,1023,1216,1550,1357,1208,1420,1089,1613,1023,1454,1322,1094,1253,1487,1859,1005,1014,1525,1897,1475,1123,1266,1743,1628,1855,1432,1876,1683,1005],[1096,1323,1585,1704,1414,1158,1659,1649,1179,1221,1375,1491,1521,1573,1519,1950,1292,1350,1730,1272,1580,1349,1281,1629,1862,1557,1457,1821,1709,1470,1127,1632,1302,1371,1508,1981,1199,1863,1939,1414,1837,1353,1689,1717,1533,1079,1720,1202],[1473,1744,1375,1289,1411,1362,1378,1501,1198,1528,1835,1888,1179,1545,1432,1878,2026,1324,2024,1408,1218,2029,1358,1203,1779,1504,1498,1701,1819,1444,1932,1162,1837,1416,1973,1278,1584,1961,1507,1294,1802,1890,2003,1702,1777,1724,1883,1746],[1286,1604,2112,1836,1555,1589,1399,1468,1864,1659,1508,1827,1296,2188,1967,1479,2180,1414,1258,1908,1642,1785,1461,1849,1401,2009,1665,1852,1358,1813,1501,1299,2038,1970,1917,2004,1902,1782,2195,1963,1763,1510,2049,1945,1283,2067,1843,1829],[2146,1740,1456,1738,2244,1382,1576,2204,2037,1624,2046,1407,1466,2270,1973,2226,2235,1511,1546,2104,1871,1700,1767,2102,1519,1426,2195,1400,1763,1581,2074,1925,1732,1850,2121,2299,2304,2068,1879,2023,1410,1714,2291,2276,2130,1638,1665,1379],[1466,1948,2122,1534,1478,1450,2070,1466,1878,1768,1450,2065,2295,1487,1501,1974,1506,1992,1460,1582,2393,2055,2360,2158,2111,1669,1713,1552,1882,1488,1710,1847,2247,2038,1593,2084,2343,1460,1934,2135,2278,1713,2277,2318,2140,2143,1981,1698],[2250,2125,1837,2009,2051,2279,1564,2146,2247,1635,1964,2217,2014,1880,2402,1810,1876,1888,1660,1700,1591,1899,1679,2403,2210,2252,2144,1794,2152,1866,2383,1795,2252,2128,2141,1577,2099,2327,2321,2316,1825,2161,2037,2308,1631,2298,1861,2021],[1673,1855,2306,2549,1873,2560,2433,1705,2372,2152,2229,1763,2221,2303,2431,2187,1925,2065,2409,2004,2200,1677,2380,2526,2518,2023,2173,2147,1890,2075,2236,2176,2239,1730,2053,2122,2112,2550,1846,2045,1875,2493,2284,2559,2349,2105,2584,1710],[1842,2373,2230,2479,2255,2141,2678,1828,1739,2474,2217,1975,1851,2584,2409,1941,2540,2571,2244,1750,1870,2254,2593,1921,2008,1798,2205,1787,2455,2296,2451,2461,2058,1795,1933,2654,2145,2392,2120,2476,1839,1751,2450,2441,2377,2515,2025,2349],[2559,1960,2648,2174,2027,2191,2468,2746,2153,1825,2115,2112,2224,2036,2505,2073,2439,2273,1884,2508,1947,2090,2734,2727,2750,2354,2285,1942,2270,2510,2560,2322,2626,1965,2209,1966,1957,2550,2630,2067,2068,1906,2747,2678,1866,2279,2609,2017],[2166,2011,1933,2858,2269,2169,1968,2062,2415,2398,2545,2558,2363,2810,2199,2419,2209,2321,2730,2629,2403,1960,2360,1945,2862,2772,2663,2231,2455,2228,2148,1935,2268,2824,2169,2832,2112,2798,2155,2614,2290,1969,2744,2039,2560,2237,2151,2864],[2419,2577,2063,2095,2822,2095,2188,2274,2454,2678,2285,2797,2613,2439,2250,2780,2880,2284,2504,2206,2748,2236,2840,2454,2847,2618,2550,2145,2544,2614,2068,2096,2323,2480,2821,2062,2710,2095,2920,2959,2457,2827,2132,2321,2880,2113,2387,2587],[2487,2188,2202,2778,2961,3050,2345,2406,2448,2725,2261,2384,2324,2981,2227,2490,2263,2527,2409,2614,2509,2642,2343,2758,2724,2219,2811,2408,2203,2492,2410,2730,3055,2438,3061,2928,2583,2595,2841,2142,2957,2708,2152,2273,2703,2620,2593,3068],[2589,2347,2567,2339,2232,2397,2431,2383,2702,2653,2571,2658,2315,2485,3053,2734,3127,2838,2526,2209,3094,2805,2911,2944,2849,2695,2715,3030,2523,2917,2284,2929,2757,2841,2414,3163,2560,2968,2234,2215,2881,2340,3083,2280,2685,2952,2338,2649],[2419,3216,2312,2469,3173,2911,2402,2474,2740,2986,2611,3081,2483,2865,3028,2777,3096,3011,2998,2678,2858,2960,2946,2767,2312,2966,2919,2662,2790,3231,2729,2992,2919,2548,2364,2989,2416,2842,2601,2592,3184,2522,3222,2733,2695,2409,2946,3124],[3219,2494,3182,2443,3067,2828,2942,2981,3057,2559,2986,3226,2697,3315,2952,3078,3071,2866,2588,2886,2541,2731,2981,2893,3175,2884,3162,2460,3114,2710,2857,2641,2537,2441,2661,3114,2748,3090,2645,2510,2569,3037,2739,3091,3100,2474,2534,2483],[2865,2736,2966,3212,2794,2966,2801,3173,3160,2976,3405,3064,2809,2872,3133,3366,3290,3086,3282,2876,3159,2594,2862,2862,2856,2599,3201,2760,2669,2894,3071,3301,3394,3415,2714,2808,2731,2883,3018,2714,2781,2702,3163,2732,2592,2980,2575,2516],[2928,3341,3376,3123,3005,3245,3153,3532,3317,2952,3012,3188,2786,2828,3432,3146,2694,3028,2975,3010,3005,3108,3208,2979,2639,3200,2931,2778,3489,2964,2768,2770,2890,2791,3215,2706,2605,3341,3189,3273,2986,3025,2641,2961,3115,3206,2891,3515],[2708,3252,3011,3452,2778,2782,2795,3194,3037,3538,2967,3507,2747,3076,2781,2928,2767,3520,3292,3086,3483,3215,2808,2887,2942,3243,3466,3174,2815,3643,2870,3209,3365,3419,2698,3077,2730,3546,2815,3620,2964,2892,3589,3290,2802,3081,2743,3744]], 10),
        "out": 9264, # TLE on 3D DP approach 
    },
    {
        "in": ([[211,330,81,691,571,697,596,460,31,111,141,628,635,24,712,261,10,538,482,716,82,388,691,117,202,23,31,538,352,512,11,485,294,179,647,470,32,631,118,99,354,455],[803,748,538,329,165,191,288,317,282,276,123,538,790,530,424,529,654,401,763,457,249,83,384,715,727,578,127,452,488,741,770,629,401,341,95,179,570,258,275,214,746,248],[207,820,653,608,662,524,871,531,819,463,779,268,848,727,616,757,733,169,527,491,610,307,167,367,847,187,811,149,345,460,474,396,514,531,669,333,680,702,747,639,460,283],[353,925,946,243,713,855,938,315,296,422,419,425,851,926,387,509,539,566,572,565,494,404,268,740,786,408,481,459,691,440,546,502,613,642,860,318,935,724,543,636,265,591],[998,463,861,512,626,605,614,644,651,766,765,487,789,377,402,686,962,414,658,425,532,378,999,360,561,609,833,746,754,732,777,542,510,399,1018,434,730,859,398,777,463,706],[424,524,994,908,847,982,820,898,1021,547,563,1026,827,708,903,888,591,755,706,889,449,798,492,386,424,660,678,391,922,679,856,1095,962,719,800,746,937,866,473,1078,564,761],[762,796,561,731,1085,673,587,911,1067,633,709,505,912,1113,761,453,569,1115,920,939,510,942,477,861,861,895,1057,948,766,629,842,500,613,616,751,999,543,1080,723,624,934,563],[936,588,1128,682,596,1061,977,1146,570,894,773,824,685,778,643,1135,1025,628,1193,1066,1213,1106,779,1146,928,1038,1102,957,797,717,627,995,925,716,742,648,1088,1016,1126,795,686,806],[820,1173,779,1085,915,1208,856,649,851,1017,620,650,792,867,1236,1064,1312,1114,1231,659,1066,1240,1212,847,1249,739,1124,879,884,1121,1056,1128,623,936,1157,667,913,962,902,1183,947,807],[1000,1309,854,1266,1037,989,707,1070,1189,814,1368,1129,1220,1035,1053,1047,1068,744,1340,1173,1291,1144,1329,1021,826,1016,1138,1361,1156,1229,859,664,1033,1186,1283,769,772,932,1033,1304,1139,1002],[1073,1191,851,1092,1005,1408,886,1445,1275,1272,869,1026,1273,1319,1455,1305,1350,1046,1073,842,1194,940,1323,747,1345,811,1408,940,1298,1439,792,790,1177,1046,822,1125,1406,1407,1319,1247,1247,1303],[1017,1302,1275,1346,1522,1122,1512,990,1499,1221,1067,1189,1503,1041,1276,1009,1189,1395,999,967,1437,877,807,1247,1471,1215,970,1221,1281,1465,1352,1474,1261,903,1394,913,1320,1386,1103,853,1416,1170],[889,1395,978,1585,1090,1472,1090,1133,1041,1033,1397,1453,1198,1540,1010,1125,1481,916,1603,1201,1296,1588,1538,1346,1026,1107,1253,1459,1521,1284,911,1558,1511,1068,1110,1021,1055,877,961,1540,1195,1023],[1353,1647,1620,1109,1657,1610,967,1658,1429,1647,1577,1205,1429,1091,1085,1135,1587,1144,1364,1547,1617,1252,1207,996,1325,1539,1635,1032,1461,1103,1558,1255,1376,1462,1262,1167,1198,1635,1554,1099,1377,1491],[1314,1477,1536,1727,1231,1393,1328,1286,1085,1502,1209,1388,1494,1715,1148,1323,1368,1633,1424,1206,1206,1172,1706,1358,1529,1411,1288,1279,1479,1745,1472,1186,1355,1112,1752,1529,1492,1481,1377,1334,1275,1370],[1286,1483,1409,1183,1262,1113,1554,1513,1542,1412,1188,1359,1461,1655,1539,1253,1369,1363,1509,1335,1628,1495,1480,1596,1730,1722,1636,1110,1162,1661,1172,1299,1629,1506,1656,1198,1611,1417,1484,1626,1740,1641],[1603,1420,1358,1580,1568,1729,1510,1711,1582,1374,1368,1216,1411,1206,1603,1564,1656,1661,1431,1516,1873,1544,1411,1292,1768,1371,1233,1212,1443,1627,1343,1424,1347,1677,1475,1472,1728,1180,1205,1311,1307,1226],[1822,1510,1708,1364,1498,1637,1330,1861,1581,1280,1413,1917,1604,1892,1645,1930,1497,1970,1394,1822,1494,1829,1970,1542,1537,1756,1516,1639,1448,1834,1267,1454,1493,1469,1728,1961,1819,1786,1475,1335,1531,1969],[2038,1754,1434,1526,1697,1566,1846,1625,1642,2003,1728,1628,1349,1794,2006,1833,1694,1823,1687,1781,1971,1533,1415,1477,1667,1429,1463,1708,1820,1566,1462,1506,1777,1959,1407,1929,1387,1848,1643,1832,1738,1974],[1622,1658,1499,1675,1878,1480,2096,1859,1991,1473,1912,1845,1963,1683,1871,1563,1641,1922,1626,1534,2026,1531,1393,1786,1983,1506,1795,2035,1901,1775,1951,1431,1669,1878,1833,2052,1933,1456,1689,2104,1940,1674],[2093,2059,2100,1734,1530,2085,2045,1925,1838,1544,2053,1688,1507,2141,1738,1552,2144,1465,1938,1816,1754,1480,2119,1868,2038,2016,2139,2050,1616,1525,1651,1660,1714,1841,1990,2061,1702,1963,1461,1543,2189,1904],[2250,2068,1574,1659,2215,1595,2129,1856,2015,2145,2073,1791,2218,1645,2022,2262,1582,1777,1540,1581,2192,2085,2212,2020,1892,1978,2002,2118,1575,1782,2051,1804,1619,1937,1693,1551,2112,2193,1827,1800,1736,2102],[1741,1794,1776,2209,2331,2204,1934,2199,1665,2174,1667,1661,1973,2302,2118,1707,2055,2141,2235,1615,1684,1949,2053,1750,1637,1858,1900,2056,1879,1671,1623,2205,2254,2110,1967,1900,1789,1796,2174,1842,1679,2084],[2094,2340,1996,2017,2053,1773,1854,1805,2185,1924,2058,2014,1732,2310,2104,1854,2027,2229,1871,1772,2018,2144,2143,1695,2122,2079,2118,1866,2163,1764,2278,2311,1839,2253,1886,1690,1698,2343,1871,1815,1872,2173],[2426,1888,1838,2156,2105,2473,2367,1950,2110,1871,1823,1769,2356,1888,1949,1842,2387,1856,2269,2464,2100,1834,2441,2108,1815,2441,1899,1975,2392,2200,2374,2311,1774,2096,2135,1942,2175,2042,2415,2350,1921,2168],[1944,2481,2232,2217,1835,2489,2127,2380,2286,2128,1859,2031,2539,2105,2233,2550,1876,2286,2242,2081,2279,2418,2110,2027,2351,2182,1879,2436,2184,2548,1904,2059,2030,2134,1838,2037,1977,2532,1901,2406,2015,2308],[1943,2424,2442,2382,2551,1996,2151,2269,1994,2476,2256,2532,2487,2251,2185,2618,2351,2074,2620,2449,2114,2339,1914,2193,2399,2167,2503,2080,2044,2446,2339,2268,2196,2242,2627,2241,2286,2371,2239,1969,2599,2195],[2269,2137,2651,2330,2398,2239,2680,2639,2341,2325,2117,2590,2392,2279,1991,1983,2476,2129,2272,2151,2151,2034,2609,2094,2403,2266,2187,2637,2190,2166,2233,2621,2605,2671,2465,2042,2659,2629,2652,2365,2543,2695],[2084,2478,2457,2204,2403,2661,2553,2328,2553,2231,2489,2228,2087,2428,2207,2351,2353,2619,2536,2664,2731,2771,2119,2201,2553,2157,2448,2358,2146,2342,2536,2087,2314,2066,2631,2387,2109,2334,2088,2444,2326,2264],[2445,2346,2275,2372,2399,2119,2607,2653,2604,2432,2448,2542,2319,2232,2140,2760,2586,2215,2752,2135,2754,2121,2584,2275,2174,2412,2844,2779,2506,2818,2746,2802,2171,2398,2805,2812,2298,2414,2378,2780,2228,2438],[2886,2260,2678,2681,2419,2593,2390,2791,2323,2766,2746,2400,2306,2852,2714,2630,2808,2835,2373,2674,2752,2564,2445,2363,2871,2423,2826,2804,2229,2614,2912,2370,2867,2238,2724,2379,2267,2634,2802,2536,2605,2199],[2371,2874,2344,2934,2733,2398,2453,2639,2413,2318,2418,2986,2423,2688,2345,2524,2715,2355,2742,2568,2872,2440,2897,2859,2914,2774,2367,2972,2800,2789,2672,2805,2696,2384,2480,2946,2590,2724,2364,2701,2734,2708],[2416,2654,2394,2760,2445,2608,2420,2823,2410,3006,2533,2490,2559,3041,2574,2713,2611,2639,2920,2963,2569,2506,2742,2713,2888,2911,2584,2607,2423,2817,2495,2748,2549,2905,3052,2885,2683,2886,2626,2818,2942,2353],[2569,2848,2571,3069,2508,2495,2923,2613,2451,2482,2916,2716,2723,2822,2450,2800,2427,2946,2622,2732,3050,2952,2960,2625,2903,3112,2444,2518,2755,2916,2540,2581,2443,2636,2509,2454,2929,3043,3089,2831,2499,2658],[2634,3007,2992,2651,2504,2952,3177,2570,2973,2838,2532,2588,2952,3163,2897,2501,3109,2541,3127,3156,3071,3174,3006,3200,3051,2538,3152,3074,2708,3207,3185,2525,2507,2971,2582,2709,2581,2913,2563,2565,3044,3011],[3271,2701,2640,3071,3057,3212,2751,3164,2940,2899,2692,2601,3142,2699,3050,3078,2904,3199,2900,2837,2673,2694,2948,3227,3253,2900,2985,3226,3229,2822,3266,2672,2799,2716,3228,2768,2654,3255,3171,2738,2912,3358]], 4),
        "out": None, # Another TLE after one optimization ... problem is the teleport lookup i bet 
    }
]

if __name__ == "__main__":
    sol = Solution()
    for test in tests:
        inp = test["in"]
        expected = test["out"]
        result = sol.minCost(*inp)
        assert result == expected, f"Test failed for input {inp}. Expected {expected}, got {result}"
    print("All tests passed.")